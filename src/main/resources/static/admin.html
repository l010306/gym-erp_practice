<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥èº«æˆ¿ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-dark: #5568d3;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-dark: #0f172a;
            --bg-card: rgba(255, 255, 255, 0.05);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            --sidebar-width: 260px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            background-image:
                radial-gradient(at 0% 0%, rgba(102, 126, 234, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(118, 75, 162, 0.1) 0px, transparent 50%);
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            font-size: 2rem;
        }

        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-menu {
            flex: 1;
            padding: 1.5rem 0;
            overflow-y: auto;
        }

        .nav-item {
            padding: 0.875rem 1.5rem;
            margin: 0.25rem 0.75rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(102, 126, 234, 0.1);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            color: var(--text-primary);
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .nav-icon {
            font-size: 1.25rem;
        }

        .main-content {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .topbar {
            height: 70px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            position: sticky;
            top: 0;
            z-index: 90;
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .menu-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-name {
            font-weight: 600;
            color: var(--success);
        }

        .user-branch {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .btn {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .content-wrapper {
            flex: 1;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .view-container {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .view-container.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .actions {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 2rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .course-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .course-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .course-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .course-card:hover::before {
            transform: scaleX(1);
        }

        .course-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .course-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .course-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .type-group {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .type-personal {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .course-info {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .info-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .info-row strong {
            color: var(--text-primary);
        }

        .course-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1e293b;
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            transition: all 0.2s;
        }

        .close-btn:hover {
            color: var(--text-primary);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 0.875rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .menu-toggle {
                display: block;
            }

            .topbar {
                padding: 0 1rem;
            }

            .content-wrapper {
                padding: 1rem;
            }

            .user-branch {
                display: none;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .courses-grid {
                grid-template-columns: 1fr;
            }

            .actions {
                flex-direction: column;
                align-items: stretch;
            }
        }

        /* Calendar Styles */
        .coach-selector {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .coach-selector label {
            font-weight: 600;
            margin-bottom: 0;
        }

        .coach-selector input {
            width: 200px;
            padding: 0.75rem 1rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .month-nav {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .month-title {
            font-size: 1.5rem;
            font-weight: 700;
            min-width: 200px;
            text-align: center;
        }

        .nav-btn {
            background: rgba(102, 126, 234, 0.2);
            color: var(--text-primary);
            border: 1px solid rgba(102, 126, 234, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            font-weight: 600;
        }

        .nav-btn:hover {
            background: rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .calendar {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .weekday {
            text-align: center;
            font-weight: 600;
            color: var(--text-secondary);
            padding: 1rem;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        .calendar-day:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.today {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .calendar-day.has-course {
            background: rgba(16, 185, 129, 0.15);
            border-color: var(--success);
        }

        .day-number {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .course-count {
            font-size: 0.75rem;
            color: var(--success);
            font-weight: 600;
        }

        .course-detail-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .course-detail-item:last-child {
            margin-bottom: 0;
        }

        .course-detail-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .course-info-row-detail {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {

            .calendar-days,
            .weekdays {
                gap: 0.5rem;
            }

            .calendar-day {
                padding: 0.5rem;
                font-size: 0.85rem;
            }

            .day-number {
                font-size: 0.9rem;
            }

            .course-count {
                font-size: 0.65rem;
            }

            .month-title {
                font-size: 1.25rem;
                min-width: 150px;
            }

            .coach-selector {
                flex-direction: column;
                align-items: stretch;
            }

            .coach-selector input {
                width: 100%;
            }
        }

        /* Renewal Styles */
        .renewal-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border);
        }

        .renewal-tab {
            padding: 1rem 2rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-family: inherit;
        }

        .renewal-tab:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }

        .renewal-tab.active {
            color: var(--text-primary);
            border-bottom-color: #667eea;
        }

        .renewal-content {
            display: none;
        }

        .renewal-content.active {
            display: block;
        }

        .renewal-table {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
        }

        .renewal-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .renewal-table th {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border);
        }

        .renewal-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .renewal-table tr:last-child td {
            border-bottom: none;
        }

        .renewal-table tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .status-approved {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .renewal-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .renewal-actions input[type="password"] {
            width: 100px;
            padding: 0.5rem;
            font-size: 0.875rem;
        }

        .renewal-form {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
        }
    </style>
</head>

<body>
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon">ğŸ’ª</span>
                <span class="logo-text">å¥èº«æˆ¿ERP</span>
            </div>
        </div>
        <nav class="nav-menu">
            <div class="nav-item active" data-view="courses">
                <span class="nav-icon">ğŸ“š</span>
                <span>è¯¾ç¨‹ç®¡ç†ç³»ç»Ÿ</span>
            </div>
            <div class="nav-item" data-view="calendar">
                <span class="nav-icon">ğŸ“…</span>
                <span>æ•™ç»ƒæ—¥å†</span>
            </div>
            <div class="nav-item" data-view="renewals">
                <span class="nav-icon">ğŸ’³</span>
                <span>ä¼šå‘˜å¡å»¶æœŸ</span>
            </div>
        </nav>
    </aside>
    <main class="main-content" id="mainContent">
        <div class="topbar">
            <div class="topbar-left">
                <button class="menu-toggle" id="menuToggle">â˜°</button>
                <h1 class="page-title" id="pageTitle">è¯¾ç¨‹ç®¡ç†ç³»ç»Ÿ</h1>
            </div>
            <div class="topbar-right">
                <div class="user-info" id="userInfo" style="display: none;">
                    <span class="user-name" id="userName"></span>
                    <span class="user-branch" id="userBranch"></span>
                </div>
                <button class="btn btn-secondary btn-small" onclick="logout()" id="logoutBtn" style="display: none;">ğŸšª
                    é€€å‡º</button>
            </div>
        </div>
        <div class="content-wrapper">
            <div class="view-container active" id="view-courses">
                <div class="actions">
                    <button class="btn btn-primary" onclick="CoursesModule.openAddModal()">â• æ·»åŠ æ–°è¯¾ç¨‹</button>
                    <button class="btn btn-secondary" onclick="CoursesModule.loadCourses()">ğŸ”„ åˆ·æ–°åˆ—è¡¨</button>
                </div>
                <div id="coursesContainer" class="courses-grid"></div>
            </div>
            <div class="view-container" id="view-calendar">
                <div class="coach-selector">
                    <label for="coachIdInput">æ•™ç»ƒID:</label>
                    <input type="number" id="coachIdInput" placeholder="è¯·è¾“å…¥æ•™ç»ƒID" value="1">
                    <button class="btn btn-primary" onclick="CalendarModule.loadCoachCourses()">ğŸ” æŸ¥çœ‹è¯¾ç¨‹</button>
                </div>

                <div class="calendar-header">
                    <div class="month-nav">
                        <button class="nav-btn" onclick="CalendarModule.previousMonth()">â† ä¸Šæœˆ</button>
                        <div class="month-title" id="calendarMonthTitle">2026å¹´1æœˆ</div>
                        <button class="nav-btn" onclick="CalendarModule.nextMonth()">ä¸‹æœˆ â†’</button>
                    </div>
                    <button class="btn btn-primary" onclick="CalendarModule.goToToday()">ğŸ“ ä»Šå¤©</button>
                </div>

                <div class="calendar">
                    <div class="weekdays">
                        <div class="weekday">å‘¨ä¸€</div>
                        <div class="weekday">å‘¨äºŒ</div>
                        <div class="weekday">å‘¨ä¸‰</div>
                        <div class="weekday">å‘¨å››</div>
                        <div class="weekday">å‘¨äº”</div>
                        <div class="weekday">å‘¨å…­</div>
                        <div class="weekday">å‘¨æ—¥</div>
                    </div>
                    <div class="calendar-days" id="calendarDaysContainer"></div>
                </div>
            </div>

            <!-- Renewals View -->
            <div class="view-container" id="view-renewals">
                <div class="renewal-tabs">
                    <button class="renewal-tab active" onclick="RenewalModule.switchTab('submit')">æäº¤ç»­è´¹ç”³è¯·</button>
                    <button class="renewal-tab" onclick="RenewalModule.switchTab('pending')">å¾…å®¡æ‰¹åˆ—è¡¨</button>
                    <button class="renewal-tab" onclick="RenewalModule.switchTab('history')">å·²å®¡æ‰¹å†å²</button>
                </div>

                <!-- Submit Tab -->
                <div class="renewal-content active" id="renewal-submit">
                    <div class="renewal-form">
                        <h2 style="margin-bottom: 1.5rem;">æäº¤ä¼šå‘˜å¡ç»­è´¹ç”³è¯·</h2>
                        <form id="renewalSubmitForm" onsubmit="RenewalModule.submitRenewal(event)">
                            <div class="form-group">
                                <label for="renewalCardId">ä¼šå‘˜å¡ ID *</label>
                                <input type="number" id="renewalCardId" required placeholder="è¯·è¾“å…¥ä¼šå‘˜å¡ID">
                            </div>
                            <div class="form-group">
                                <label for="renewalMonths">ç»­è´¹æ—¶é•¿ (æœˆ) *</label>
                                <input type="number" id="renewalMonths" required min="1" value="12"
                                    placeholder="è¯·è¾“å…¥ç»­è´¹æœˆæ•°">
                            </div>
                            <button type="submit" class="btn btn-primary">æäº¤ç”³è¯·</button>
                        </form>
                        <div id="renewalSubmitMessage" style="margin-top: 1rem;"></div>
                    </div>
                </div>

                <!-- Pending Tab -->
                <div class="renewal-content" id="renewal-pending">
                    <div class="renewal-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ä¼šå‘˜å¡ID</th>
                                    <th>åŸæœ‰æ•ˆæœŸ</th>
                                    <th>æ–°æœ‰æ•ˆæœŸ</th>
                                    <th>ç”³è¯·äººID</th>
                                    <th>çŠ¶æ€</th>
                                    <th>æäº¤æ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="pendingRenewalsTableBody">
                                <tr>
                                    <td colspan="8" style="text-align: center; color: var(--text-secondary);">åŠ è½½ä¸­...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- History Tab -->
                <div class="renewal-content" id="renewal-history">
                    <div class="renewal-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ä¼šå‘˜å¡ID</th>
                                    <th>åŸæœ‰æ•ˆæœŸ</th>
                                    <th>æ–°æœ‰æ•ˆæœŸ</th>
                                    <th>ç”³è¯·äººID</th>
                                    <th>å®¡æ‰¹äººID</th>
                                    <th>çŠ¶æ€</th>
                                    <th>æäº¤æ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="historyRenewalsTableBody">
                                <tr>
                                    <td colspan="9" style="text-align: center; color: var(--text-secondary);">åŠ è½½ä¸­...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Login Modal -->
    <div class="modal active" id="loginModal">
        <div class="modal-content" style="max-width: 450px; padding: 3rem;">
            <div class="modal-header" style="text-align: center; justify-content: center; margin-bottom: 2rem;">
                <div>
                    <h2 class="modal-title" style="font-size: 1.75rem; margin-bottom: 0.5rem;">ğŸ” å‘˜å·¥ç™»å½•</h2>
                    <p style="color: var(--text-secondary);">è¯·è¾“å…¥æ‚¨çš„å‘˜å·¥å‡­è¯</p>
                </div>
            </div>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="loginEmployeeId">å‘˜å·¥ID</label>
                    <input type="number" id="loginEmployeeId" required placeholder="è¯·è¾“å…¥å‘˜å·¥ID" value="1">
                </div>
                <div class="form-group">
                    <label for="loginPassword">å¯†ç </label>
                    <input type="password" id="loginPassword" required placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">ç™»å½•</button>
            </form>
        </div>
    </div>
    <div id="courseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">æ·»åŠ æ–°è¯¾ç¨‹</h2>
                <button class="close-btn" onclick="CoursesModule.closeModal()">âœ•</button>
            </div>
            <form id="courseForm" onsubmit="CoursesModule.saveCourse(event)">
                <input type="hidden" id="courseId">
                <div class="form-group">
                    <label for="courseName">è¯¾ç¨‹åç§° *</label>
                    <select id="courseName" required>
                        <option value="BODYPUMP">BODYPUMP</option>
                        <option value="BODYCOMBAT">BODYCOMBAT</option>
                        <option value="HIIT">HIIT</option>
                        <option value="ç‘œä¼½">ç‘œä¼½</option>
                        <option value="æ™®æ‹‰æ">æ™®æ‹‰æ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="courseDescription">è¯¾ç¨‹ä»‹ç»</label>
                    <textarea id="courseDescription" placeholder="ç®€è¦ä»‹ç»è¯¾ç¨‹å†…å®¹å’Œç‰¹ç‚¹"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="courseType">è¯¾ç¨‹ç±»å‹ *</label>
                        <select id="courseType" required>
                            <option value="GROUP">å›¢è¯¾</option>
                            <option value="PERSONAL">ç§æ•™ä¸€å¯¹ä¸€</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="courseStartTime">å¼€å§‹æ—¶é—´ *</label>
                        <input type="datetime-local" id="courseStartTime" required>
                    </div>
                    <div class="form-group">
                        <label for="courseEndTime">ç»“æŸæ—¶é—´ *</label>
                        <input type="datetime-local" id="courseEndTime" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="courseCapacity">æœ€å¤§å®¹é‡ *</label>
                        <input type="number" id="courseCapacity" required placeholder="1" min="1">
                    </div>
                </div>
                <div class="form-group">
                    <label for="courseCoach">é€‰æ‹©æ•™ç»ƒ *</label>
                    <select id="courseCoach" required>
                        <option value="">-- è¯·é€‰æ‹©æ•™ç»ƒ --</option>
                    </select>
                </div>
                <div class="form-row">
                    <button type="button" class="btn btn-secondary" onclick="CoursesModule.closeModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜è¯¾ç¨‹</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Calendar Course Details Modal -->
    <div id="calendarCourseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="calendarModalDate">è¯¾ç¨‹è¯¦æƒ…</h2>
                <button class="close-btn" onclick="CalendarModule.closeModal()">âœ•</button>
            </div>
            <div id="calendarCourseList"></div>
        </div>
    </div>

    <script>
        const AppState = { currentEmployee: null, currentView: 'courses' };
        const CoursesModule = {
            API_BASE: '/api/courses',
            currentEditId: null,
            async loadCoaches(branchId) {
                try {
                    const response = await fetch(`/api/coaches?branchId=${branchId}`);
                    if (!response.ok) throw new Error('åŠ è½½æ•™ç»ƒåˆ—è¡¨å¤±è´¥');
                    const coaches = await response.json();
                    const coachSelect = document.getElementById('courseCoach');
                    coachSelect.innerHTML = '<option value="">-- è¯·é€‰æ‹©æ•™ç»ƒ --</option>';
                    coaches.forEach(coach => {
                        const option = document.createElement('option');
                        option.value = coach.id;
                        option.textContent = coach.name;
                        coachSelect.appendChild(option);
                    });
                } catch (error) {
                    console.error('åŠ è½½æ•™ç»ƒåˆ—è¡¨å¤±è´¥:', error);
                    alert('åŠ è½½æ•™ç»ƒåˆ—è¡¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            },
            async loadCourses() {
                if (!AppState.currentEmployee) { alert('è¯·å…ˆç™»å½•'); return; }
                try {
                    const response = await fetch(this.API_BASE);
                    const allCourses = await response.json();
                    const courses = allCourses.filter(c => c.branchId === AppState.currentEmployee.branchId);
                    const container = document.getElementById('coursesContainer');
                    if (courses.length === 0) {
                        container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“­</div><h3>æš‚æ— è¯¾ç¨‹</h3><p>ç‚¹å‡»"æ·»åŠ æ–°è¯¾ç¨‹"åˆ›å»ºç¬¬ä¸€ä¸ªè¯¾ç¨‹</p></div>';
                        return;
                    }
                    container.innerHTML = courses.map(course => {
                        const courseType = course.type || 'GROUP';
                        return `
                        <div class="course-card">
                            <div class="course-header">
                                <div>
                                    <h3 class="course-title">${course.name}</h3>
                                    <span class="course-type type-${courseType.toLowerCase()}">${courseType === 'GROUP' ? 'å›¢è¯¾' : 'ç§æ•™'}</span>
                                </div>
                            </div>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">${course.description || 'æš‚æ— ä»‹ç»'}</p>
                            <div class="course-info">
                                <div class="info-row"><span>ğŸ•</span><span><strong>å¼€å§‹:</strong> ${this.formatDateTime(course.startTime)}</span></div>
                                <div class="inn>ğŸ•</span><span><strong>ç»“æŸ:</strong> ${this.formatDateTime(course.endTime)}</span></div>
                                <div class="info-row"><span>ğŸ‘¥</span><span><strong>å®¹é‡:</strong> ${course.maxCapacity} äºº</span></div>
                                <div class="info-row"><span>ğŸ‘¨â€ğŸ«</span><span><strong>æ•™ç»ƒ:</strong> ${course.coach ? course.coach.name : 'æœªæŒ‡å®š'}</span></div>
                            </div>
                            <div class="course-actions">
                                <button class="btn btn-secondary btn-small" onclick="CoursesModule.editCourse(${course.id})">âœï¸ ç¼–è¾‘</button>
                                <button class="btn btn-danger btn-small" onclick="CoursesModule.deleteCourse(${course.id})">ğŸ—‘ï¸ åˆ é™¤</button>
                            </div>
                        </div>`;
                    }).join('');
                } catch (error) {
                    console.error('åŠ è½½è¯¾ç¨‹å¤±è´¥:', error);
                    alert('åŠ è½½è¯¾ç¨‹åˆ—è¡¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            },
            openAddModal() {
                if (!AppState.currentEmployee) { alert('è¯·å…ˆç™»å½•'); return; }
                this.currentEditId = null;
                document.getElementById('modalTitle').textContent = 'æ·»åŠ æ–°è¯¾ç¨‹';
                document.getElementById('courseForm').reset();
                document.getElementById('courseId').value = '';
                this.loadCoaches(AppState.currentEmployee.branchId);
                document.getElementById('courseModal').classList.add('active');
            },
            async editCourse(id) {
                try {
                    const response = await fetch(`${this.API_BASE}/${id}`);
                    const course = await response.json();
                    this.currentEditId = id;
                    document.getElementById('modalTitle').textContent = 'ç¼–è¾‘è¯¾ç¨‹';
                    doct.gntById('courseId').value = id;
                    document.getElementById('courseName').value = course.name;
                    document.getElementById('courseDescription').value = course.description || '';
                    document.getElementById('courseType').value = course.type;
                    document.getElementById('courseStartTime').value = this.formatDateTimeInput(course.startTime);
                    document.getElementById('courseEndTime').value = this.formatDateTimeInput(course.endTime);
                    document.getElementById('courseCapacity').value = course.maxCapacity;
                    await this.loadCoaches(course.branchId);
                    document.getElementById('courseCoach').value = course.coach ? course.coach.id : '';
                    document.getElementById('courseModal').classList.add('active');
                } catch (error) {
                    console.error('åŠ è½½è¯¾ç¨‹è¯¦æƒ…å¤±è´¥:', error);
                    alert('åŠ è½½è¯¾ç¨‹è¯¦æƒ…å¤±è´¥');
                }
            },
            async saveCourse(event) {
                event.preventDefault();
                if (!AppState.currentEmployee) { alert('è¯·å…ˆç™»å½•'); return; }
                const courseData = {
                    name: document.getElementById('courseName').value,
                    description: document.getElementById('courseDescription').value,
                    type: document.getElementById('courseType').value,
                    startTime: document.getElementById('courseStartTime').value,
                    endTime: document.getElementById('courseEndTime').value,
                    maxCapacity: parseInt(document.getElementById('courseCapacity').value),
                    branchId: AppState.currentEmployee.branchId,
                    coach: { id: parseInt(document.getElementById('courseCoach').value) }
                };
                const employeeId = AppState.currentEmployee.id;
                try {
                    let response;
                    if (this.currentEditId) {
                        response = await fetch(`${this.API_BASE}/${this.currentEditId}?employeeId=${employeeId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(courseData)
                        });
                    } else {
                        response = await fetch(`${this.API_BASE}?employeeId=${employeeId}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(courseData)
                        });
                    }
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'ä¿å­˜å¤±è´¥');
                    }
                    alert(this.currentEditId ? 'è¯¾ç¨‹æ›´æ–°æˆåŠŸï¼' : 'è¯¾ç¨‹åˆ›å»ºæˆåŠŸï¼');
                    this.closeModal();
                    this.loadCourses();
                } catch (error) {
                    console.error('ä¿å­˜è¯¾ç¨‹å¤±è´¥:', error);
                    alert('ä¿å­˜è¯¾ç¨‹å¤±è´¥ï¼š' + error.message);
                }
            },
            async deleteCourse(id) {
                if (!AppState.currentEmployee) { alert('è¯·å…ˆç™»å½•'); return; }
                if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¯¾ç¨‹å—ï¼Ÿ')) return;
                const employeeId = AppState.currentEmployee.id;
                try {
                    const response = await fetch(`${this.API_BASE}/${id}?employeeId=${employeeId}`, { method: 'DELETE' });
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'åˆ é™¤å¤±è´¥');
                    }
                    alert('è¯¾ç¨‹åˆ é™¤æˆåŠŸï¼');
                    this.loadCourses();
                } catch (error) {
                    console.error('åˆ é™¤è¯¾ç¨‹å¤±è´¥:', error);
                    alert('åˆ é™¤å¤±è´¥ï¼š' + error.message);
                }
            },
            closeModal() { document.getElementById('courseModal').classList.remove('active'); },
            formatDateTime(dateTimeStr) {
                const date = new Date(dateTimeStr);
                return date.toLocaleString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });
            },
            formatDateTimeInput(dateTimeStr) {
                const date = new Date(dateTimeStr);
                return date.toISOString().slice(0, 16);
            }
        };
        document.addEventListener('DOMContentLoaded', () => { initializeApp(); });
        function initializeApp() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => { switchView(item.getAttribute('data-view')); });
            });
            document.getElementById('menuToggle').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('show');
            });
            document.getElementById('mainContent').addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    document.getElementById('sidebar').classList.remove('show');
                }
            });
            document.getElementById('courseModal').addEventListener('click', (e) => {
                if (e.target.id === 'courseModal') { CoursesModule.closeModal(); }
            });
        }
        async function handleLogin(event) {
            event.preventDefault();
            const employeeId = document.getElementById('loginEmployeeId').value;
            const password = document.getElementById('loginPassword').value;
            try {
                const response = await fetch('/api/employees/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ employeeId, password })
                });
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'ç™»å½•å¤±è´¥');
                }
                AppState.currentEmployee = await response.json();
                document.getElementById('userName').textContent = `ğŸ‘¤ ${AppState.currentEmployee.name}`;
                document.getElementById('userBranch').textContent = `ğŸ¢ é—¨åº—${AppState.currentEmployee.branchId}`;
                document.getElementById('userInfo').style.display = 'flex';
                document.getElementById('logoutBtn').style.display = 'block';
                document.getElementById('loginModal').classList.remove('active');
                loadCurrentView();
            } catch (error) {
                console.error('ç™»å½•å¤±è´¥:', error);
                alert('ç™»å½•å¤±è´¥: ' + error.message);
            }
        }

        // Calendar Module
        const CalendarModule = {
            currentDate: new Date(),
            currentCoachId: null,
            coursesData: [],

            async loadCoachCourses() {
                const coachId = document.getElementById('coachIdInput').value;
                if (!coachId) {
                    alert('è¯·è¾“å…¥æ•™ç»ƒID');
                    return;
                }

                this.currentCoachId = coachId;

                try {
                    const response = await fetch('/api/courses');
                    if (!response.ok) throw new Error('åŠ è½½è¯¾ç¨‹å¤±è´¥');
                    const allCourses = await response.json();

                    // ç­›é€‰è¯¥æ•™ç»ƒçš„è¯¾ç¨‹
                    this.coursesData = allCourses.filter(c => c.coach && c.coach.id == coachId);

                    this.renderCalendar();
                } catch (error) {
                    console.error('åŠ è½½è¯¾ç¨‹å¤±è´¥:', error);
                    alert('åŠ è½½è¯¾ç¨‹å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            },

            renderCalendar() {
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();

                // æ›´æ–°æœˆä»½æ ‡é¢˜
                document.getElementById('calendarMonthTitle').textContent = `${year}å¹´${month + 1}æœˆ`;

                // è·å–å½“æœˆç¬¬ä¸€å¤©å’Œæœ€åä¸€å¤©
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);

                // è·å–ç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå‡  (0-6, 0æ˜¯å‘¨æ—¥)
                let startDayOfWeek = firstDay.getDay();
                startDayOfWeek = startDayOfWeek === 0 ? 6 : startDayOfWeek - 1; // è½¬æ¢ä¸ºå‘¨ä¸€å¼€å§‹

                const daysInMonth = lastDay.getDate();
                const daysInPrevMonth = new Date(year, month, 0).getDate();

                const daysContainer = document.getElementById('calendarDaysContainer');
                daysContainer.innerHTML = '';

                // ä¸Šæœˆçš„æ—¥æœŸ
                for (let i = startDayOfWeek - 1; i >= 0; i--) {
                    const day = daysInPrevMonth - i;
                    const dayEl = this.createDayElement(day, true, year, month - 1);
                    daysContainer.appendChild(dayEl);
                }

                // å½“æœˆçš„æ—¥æœŸ
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayEl = this.createDayElement(day, false, year, month);
                    daysContainer.appendChild(dayEl);
                }

                // ä¸‹æœˆçš„æ—¥æœŸï¼ˆå¡«å……åˆ°å®Œæ•´å‘¨ï¼‰
                const totalDays = startDayOfWeek + daysInMonth;
                const remainingDays = (7 - (totalDays % 7)) % 7;
                for (let day = 1; day <= remainingDays; day++) {
                    const dayEl = this.createDayElement(day, true, year, month + 1);
                    daysContainer.appendChild(dayEl);
                }
            },

            createDayElement(day, isOtherMonth, year, month) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';

                if (isOtherMonth) {
                    dayEl.classList.add('other-month');
                }

                // æ£€æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©
                const today = new Date();
                const checkDate = new Date(year, month, day);

                if (!isOtherMonth &&
                    checkDate.getDate() === today.getDate() &&
                    checkDate.getMonth() === today.getMonth() &&
                    checkDate.getFullYear() === today.getFullYear()) {
                    dayEl.classList.add('today');
                }

                // æ£€æŸ¥æ˜¯å¦æœ‰è¯¾ç¨‹
                const coursesOnDay = this.getCoursesForDate(checkDate);
                if (coursesOnDay.length > 0) {
                    dayEl.classList.add('has-course');
                    dayEl.innerHTML = `
                        <div class="day-number">${day}</div>
                        <div class="course-count">${coursesOnDay.length} èŠ‚è¯¾</div>
                    `;
                } else {
                    dayEl.innerHTML = `<div class="day-number">${day}</div>`;
                }

                // ç‚¹å‡»äº‹ä»¶
                dayEl.onclick = () => this.showCourseDetails(checkDate, coursesOnDay);

                return dayEl;
            },

            getCoursesForDate(date) {
                if (!this.coursesData || this.coursesData.length === 0) return [];

                const dateStr = date.toISOString().split('T')[0];
                return this.coursesData.filter(course => {
                    const courseDate = new Date(course.startTime).toISOString().split('T')[0];
                    return courseDate === dateStr;
                });
            },

            showCourseDetails(date, courses) {
                const modal = document.getElementById('calendarCourseModal');
                const modalDate = document.getElementById('calendarModalDate');
                const courseList = document.getElementById('calendarCourseList');

                modalDate.textContent = this.formatDate(date);

                if (courses.length === 0) {
                    courseList.innerHTML = '<div class="empty-state">å½“å¤©æ²¡æœ‰è¯¾ç¨‹å®‰æ’</div>';
                } else {
                    courseList.innerHTML = courses.map(course => `
                        <div class="course-detail-item">
                            <div class="course-detail-title">${course.name}</div>
                            <div class="course-info-row-detail">
                                <span>ğŸ•</span>
                                <span>${this.formatTime(course.startTime)} - ${this.formatTime(course.endTime)}</span>
                            </div>
                            <div class="course-info-row-detail">
                                <span>ğŸ“</span>
                                <span>${course.type === 'GROUP' ? 'å›¢è¯¾' : 'ç§æ•™'}</span>
                            </div>
                            <div class="course-info-row-detail">
                                <span>ğŸ‘¥</span>
                                <span>å®¹é‡: ${course.maxCapacity} äºº</span>
                            </div>
                        </div>
                    `).join('');
                }

                modal.classList.add('active');
            },

            closeModal() {
                document.getElementById('calendarCourseModal').classList.remove('active');
            },

            previousMonth() {
                this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                this.renderCalendar();
            },

            nextMonth() {
                this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                this.renderCalendar();
            },

            goToToday() {
                this.currentDate = new Date();
                this.renderCalendar();
            },

            formatDate(date) {
                return date.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'long'
                });
            },

            formatTime(dateTimeStr) {
                const date = new Date(dateTimeStr);
                return date.toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        };

        // Renewal Module
        const RenewalModule = {
            currentTab: 'submit',
            switchTab(tabName) {
                this.currentTab = tabName;
                document.querySelectorAll('.renewal-tab').forEach(tab => tab.classList.remove('active'));
                event.target.classList.add('active');
                document.querySelectorAll('.renewal-content').forEach(content => content.classList.remove('active'));
                document.getElementById(`renewal-${tabName}`).classList.add('active');
                if (tabName === 'pending') this.loadPendingRenewals();
                else if (tabName === 'history') this.loadHistoryRenewals();
            },
            async loadPendingRenewals() {
                try {
                    const response = await fetch('/api/renewals/pending');
                    if (!response.ok) throw new Error('åŠ è½½å¾…å®¡æ‰¹åˆ—è¡¨å¤±è´¥');
                    const renewals = await response.json();
                    this.renderPendingTable(renewals);
                } catch (error) {
                    console.error('åŠ è½½å¾…å®¡æ‰¹åˆ—è¡¨å¤±è´¥:', error);
                    alert('åŠ è½½å¾…å®¡æ‰¹åˆ—è¡¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            },
            async loadHistoryRenewals() {
                try {
                    const response = await fetch('/api/renewals/history');
                    if (!response.ok) throw new Error('åŠ è½½å†å²è®°å½•å¤±è´¥');
                    const renewals = await response.json();
                    this.renderHistoryTable(renewals);
                } catch (error) {
                    console.error('åŠ è½½å†å²è®°å½•å¤±è´¥:', error);
                    alert('åŠ è½½å†å²è®°å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            },
            renderPendingTable(renewals) {
                const tbody = document.getElementById('pendingRenewalsTableBody');
                if (renewals.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-secondary);">æš‚æ— å¾…å®¡æ‰¹ç”³è¯·</td></tr>';
                    return;
                }
                tbody.innerHTML = renewals.map(renewal => `
                    <tr>
                        <td>${renewal.id}</td>
                        <td>${renewal.cardId}</td>
                        <td>${renewal.oldExpireDate || '-'}</td>
                        <td>${renewal.newExpireDate}</td>
                        <td>${renewal.requesterId}</td>
                        <td><span class="status-badge status-pending">å¾…å®¡æ‰¹</span></td>
                        <td>${this.formatDateTime(renewal.createdAt)}</td>
                        <td>
                            <div class="renewal-actions">
                                <input type="password" id="password-${renewal.id}" placeholder="ç»ç†å¯†ç " style="width: 100px;">
                                <button class="btn btn-primary btn-small" onclick="RenewalModule.approveRenewal(${renewal.id})">é€šè¿‡</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            },
            renderHistoryTable(renewals) {
                const tbody = document.getElementById('historyRenewalsTableBody');
                if (renewals.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: var(--text-secondary);">æš‚æ— å†å²è®°å½•</td></tr>';
                    return;
                }
                tbody.innerHTML = renewals.map(renewal => `
                    <tr>
                        <td>${renewal.id}</td>
                        <td>${renewal.cardId}</td>
                        <td>${renewal.oldExpireDate || '-'}</td>
                        <td>${renewal.newExpireDate}</td>
                        <td>${renewal.requesterId}</td>
                        <td>${renewal.approverId || '-'}</td>
                        <td><span class="status-badge status-approved">å·²å®¡æ‰¹</span></td>
                        <td>${this.formatDateTime(renewal.createdAt)}</td>
                        <td>
                            <div class="renewal-actions">
                                <input type="password" id="revoke-password-${renewal.id}" placeholder="ç»ç†å¯†ç " style="width: 100px;">
                                <button class="btn btn-danger btn-small" onclick="RenewalModule.revokeRenewal(${renewal.id})">æ’¤é”€</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            },
            async submitRenewal(event) {
                event.preventDefault();
                if (!AppState.currentEmployee) { alert('è¯·å…ˆç™»å½•'); return; }
                const cardId = document.getElementById('renewalCardId').value;
                const monthsToAdd = document.getElementById('renewalMonths').value;
                const messageDiv = document.getElementById('renewalSubmitMessage');
                try {
                    const response = await fetch('/api/renewals', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ cardId: parseInt(cardId), requesterId: AppState.currentEmployee.id, monthsToAdd: parseInt(monthsToAdd) })
                    });
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'æäº¤å¤±è´¥');
                    }
                    messageDiv.innerHTML = '<p style="color: var(--success); font-weight: 600;">âœ“ ç”³è¯·æäº¤æˆåŠŸï¼è¯·é€šçŸ¥ç»ç†å®¡æ‰¹ã€‚</p>';
                    document.getElementById('renewalSubmitForm').reset();
                    document.getElementById('renewalMonths').value = 12;
                    setTimeout(() => { document.querySelector('.renewal-tab[onclick*="pending"]').click(); }, 2000);
                } catch (error) {
                    messageDiv.innerHTML = `<p style="color: var(--danger); font-weight: 600;">âœ— ${error.message}</p>`;
                }
            },
            async approveRenewal(logId) {
                if (!AppState.currentEmployee) { alert('è¯·å…ˆç™»å½•'); return; }
                const password = document.getElementById(`password-${logId}`).value;
                if (!password) { alert('è¯·è¾“å…¥ç»ç†å¯†ç '); return; }
                try {
                    const response = await fetch(`/api/renewals/${logId}/approve`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ approverId: AppState.currentEmployee.id, password: password })
                    });
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'å®¡æ‰¹å¤±è´¥');
                    }
                    alert('å®¡æ‰¹æˆåŠŸï¼');
                    this.loadPendingRenewals();
                } catch (error) {
                    alert('å®¡æ‰¹å¤±è´¥: ' + error.message);
                }
            },
            async revokeRenewal(logId) {
                if (!AppState.currentEmployee) { alert('è¯·å…ˆç™»å½•'); return; }
                const password = document.getElementById(`revoke-password-${logId}`).value;
                if (!password) { alert('è¯·è¾“å…¥ç»ç†å¯†ç '); return; }
                if (!confirm('ç¡®å®šè¦æ’¤é”€æ­¤ç”³è¯·å—ï¼Ÿ')) return;
                try {
                    const response = await fetch(`/api/renewals/${logId}/revoke`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ approverId: AppState.currentEmployee.id, password: password })
                    });
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'æ’¤é”€å¤±è´¥');
                    }
                    alert('æ’¤é”€æˆåŠŸï¼');
                    this.loadHistoryRenewals();
                } catch (error) {
                    alert('æ’¤é”€å¤±è´¥: ' + error.message);
                }
            },
            formatDateTime(dateTimeStr) {
                if (!dateTimeStr) return '-';
                const date = new Date(dateTimeStr);
                return date.toLocaleString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });
            }
        };

        function logout() {
            AppState.currentEmployee = null;
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('loginModal').classList.add('active');
            document.getElementById('loginPassword').value = '';
            document.getElementById('coursesContainer').innerHTML = '';
            CalendarModule.coursesData = [];
            CalendarModule.currentCoachId = null;
            document.getElementById('calendarDaysContainer').innerHTML = '';
        }
        function switchView(viewName) {
            AppState.currentView = viewName;
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.getAttribute('data-view') === viewName) { item.classList.add('active'); }
                else { item.classList.remove('active'); }
            });
            document.querySelectorAll('.view-container').forEach(container => {
                if (container.id === `view-${viewName}`) { container.classList.add('active'); }
                else { container.classList.remove('active'); }
            });
            const titles = { 'courses': 'è¯¾ç¨‹ç®¡ç†ç³»ç»Ÿ', 'calendar': 'æ•™ç»ƒæ—¥å†', 'renewals': 'ä¼šå‘˜å¡å»¶æœŸ' };
            document.getElementById('pageTitle').textContent = titles[viewName] || 'ç®¡ç†ç³»ç»Ÿ';
            loadCurrentView();
        }
        function loadCurrentView() {
            if (!AppState.currentEmployee) return;
            if (AppState.currentView === 'courses') {
                CoursesModule.loadCourses();
            } else if (AppState.currentView === 'calendar') {
                CalendarModule.renderCalendar();
            } else if (AppState.currentView === 'renewals') {
                // Renewals load on tab switch
            }
        }

        // Event listener for calendar modal
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('calendarCourseModal').addEventListener('click', (e) => {
                if (e.target.id === 'calendarCourseModal') {
                    CalendarModule.closeModal();
                }
            });
        });
    </script>
</body>

</html>